<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pok√©mon.io</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.1/socket.io.js" integrity="sha512-9mpsATI0KClwt+xVZfbcf2lJ8IFBAwsubJ6mI3rtULwyM3fBmQFzj0It4tGqxLOGQwGfJdk/G+fANnxfq9/cew==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
  
   <section class="world"></section>
   <section class="login">
    <input type="text" placeholder="Nick" class="input">
    <button class="button">Go</button>
   </section>

   <script type="text/javascript">

    const button = document.querySelector(".button")
    const input = document.querySelector(".input")
    const world = document.querySelector(".world")

    let socket = io('https://mmorpgio.herokuapp.com/')

    socket.on("synchronize", data => {
        render(data)
    })
    
    socket.on("login", data => {
        newPlayer(data)
    })


    function player(){
        const name = localStorage.getItem('name')
        const x = localStorage.getItem('x')
        const y = localStorage.getItem('y')
        return {name, x, y}
    }

   
    function login(){
        localStorage.setItem('name', input.value)
        localStorage.setItem('x', 255)
        localStorage.setItem('y', 20)
        socket.emit('create', {name: input.value, x:255, y:20})
        newPlayer({name: input.value, x:255, y:20})
        input.value = ""
    }

    button.addEventListener('click', login)


    function newPlayer(data){
      const {name, x, y} = data
      const div = document.createElement("div")
      div.classList.add("player", name)
      div.style.margin = `${y}px ${x}px`
      const namePlayer = document.createElement("p")
      namePlayer.innerText = name;
      const sprite = document.createElement("img")
      sprite.src = "../img/sprite.png"
      div.appendChild(namePlayer)
      div.appendChild(sprite)
      world.appendChild(div)
  }


    function remove(name){
        const sprite =document.querySelector(`.${name}`)
        sprite.remove()
    }  
  
  
  function render(data){
        const {name, x, y} = data
        remove(name)
        const div = document.createElement("div")
        div.classList.add("player", name)
        div.style.margin = `${y}px ${x}px`
        const namePlayer = document.createElement("p")
        namePlayer.innerText = name;
        const sprite = document.createElement("img")
        sprite.src = "../img/sprite.png"
        div.appendChild(namePlayer)
        div.appendChild(sprite)
        world.appendChild(div)
    }



    function motion(key){
        const data = player()
        const {name, x, y} = data

        let pX = JSON.parse(x)
        let pY = JSON.parse(y)

        if(key === "ArrowUp"){
            pY -= 20;
        }
        if(key === "ArrowDown"){
            pY += 20;
        }
        if(key === "ArrowLeft"){
            pX -= 20;
        }
        if(key === "ArrowRight"){
            pX += 20;
        }

        render({name, x:pX, y:pY})
        socket.emit("update", {name, x:pX, y:pY})
        localStorage.setItem('x', pX)
        localStorage.setItem('y', pY)
    }

    document.body.addEventListener("keydown", function(evt){
        if(evt.key === "ArrowUp" || evt.key === "ArrowDown" || evt.key === "ArrowLeft" || evt.key === "ArrowRight"){
            motion(evt.key)
        }
    });

   </script>
   
</body>
</html>

